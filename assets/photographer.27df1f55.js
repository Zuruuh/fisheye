var k=Object.defineProperty;var E=(i,t,e)=>t in i?k(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var a=(i,t,e)=>(E(i,typeof t!="symbol"?t+"":t,e),e);import{P as S,a as P,H as d,I as m,S as u}from"./Selectors.a25b34db.js";class T{static async getPhotographerFromUrl(t){if(!t.searchParams.has("id"))return null;const e=t.searchParams.get("id");return Number(e)?await new S().get(Number(e)):null}}class C extends P{getCacheKey(){return"medias"}async getAllMediasForPhotograph(t){return(await this.all()).filter(e=>e.photographerId===t.id)}}class A{constructor(t,e){a(this,"isLiked",!1);this.media=t,this.likesStore=e}async toggleLiked(){this.isLiked=!this.isLiked;const t=this.isLiked?1:-1;this.likesStore.next(this.likesStore.current+t)}getLikesCount(){return this.media.likes+Number(this.isLiked)}onLikeButtonPress(t){this.toggleLiked();const e=t.currentTarget.querySelector("span");e.textContent=String(this.getLikesCount())}render(){return d.node({tag:"div",children:[{tag:"span",text:this.media.title},{tag:"button",attributes:{class:"likes-button"},eventListeners:{click:this.onLikeButtonPress.bind(this)},children:[{tag:"span",text:String(this.getLikesCount())},{tag:"i",attributes:{class:"fas fa-heart"}}]}]})}}class p{static generate(){return(Math.random()+1).toString(36).substring(2)}}class y{constructor(t){a(this,"subscribers",{});this.value=t}next(t){return this.value=t,Object.values(this.subscribers).map(e=>e(t))}subscribe(t){const e=this.generateSubscriberKey();return this.subscribers[e]=t,e}subscribeForPageLifecycle(t){const e=this.subscribe(t);window.addEventListener("beforeunload",()=>this.unsubscribe.bind(this)(e))}unsubscribe(t){const e=t in this.subscribers;return e&&delete this.subscribers[t],e}get current(){return this.value}generateSubscriberKey(){const t=p.generate();return t in this.subscribers?this.generateSubscriberKey():t}}class D extends y{constructor(e,s,r,n=""){super(r);a(this,"id");a(this,"expanded",!1);if(this.parent=e,this.options=s,this.labelledBy=n,this.id=p.generate(),Object.keys(s).length<2)throw new Error("Please provide at least two dropdown options!");this.attach()}render(){return d.node({tag:"div",attributes:{class:`dropdown dropdown-${this.id} ${this.expanded?"expanded":""}`},children:this.generateOptions()})}attach(){const e=this.render(),s=this.parent.querySelector(`.dropdown.dropdown-${this.id}`);if(s){s.replaceWith(e);return}this.parent.appendChild(e)}generateOptions(){if(!this.expanded)return[this.generateSelectHeader()];const e={...this.options};delete e[this.current];const s=this.generateSelectHeader(),r=Object.entries(e).map(([n,l])=>({tag:"button",eventListeners:{click:()=>this.onClick.bind(this)(n)},...typeof l=="string"?{text:l}:{children:[l]}}));return[s,...r]}generateSelectHeader(){return{tag:"button",insertionStrategy:m.PREPEND,attributes:{class:"selected","aria-labelledby":this.labelledBy},eventListeners:{click:()=>this.onClick.bind(this)(this.current)},children:[{tag:"span",text:this.options[this.current]},{tag:"i",attributes:{class:`fas ${this.expanded?"fa-chevron-up":"fa-chevron-down"}`}}]}}onClick(e){this.expanded&&this.current!==e&&this.next(e),this.toggle()}toggle(){this.expanded=!this.expanded,this.attach()}}var h=(i=>(i[i.TITLE=0]="TITLE",i[i.TRENDING=1]="TRENDING",i[i.DATE=2]="DATE",i))(h||{});class M{sort(t){return t.sort((e,s)=>new Date(e.date).getTime()-new Date(s.date).getTime())}}class x{sort(t){return t.sort((e,s)=>s.likes-e.likes)}}class ${sort(t){return t.sort((e,s)=>e.title.localeCompare(s.title))}}class f{constructor(t){this.medias=t}sort(t){return t.sort(this.medias)}static getSorter(t){const e={[h.TRENDING]:x,[h.DATE]:M,[h.TITLE]:$}[t];return new e}}class I{constructor(t,e){a(this,"id");a(this,"elements",[]);a(this,"shown",!1);a(this,"lastIndex",0);a(this,"triggers",[]);this.index=t,this.parent=e,this.id=p.generate()}next(){let t=this.index+1;t===this.elements.length&&(t=0),this.index=t,this.attach()}previous(){let t=this.index-1;t<0&&(t=this.elements.length-1),this.index=t,this.attach()}to(t){if(t>=this.elements.length||t<0)throw new Error("Index out of range!");this.index=t,this.attach()}render(){const{element:t,label:e}=this.elements[this.index];return d.node({tag:"div",attributes:{id:`lightbox-${this.id}`,class:`lightbox lightbox-${this.id}`,tabindex:"-1"},eventListeners:{keydown:this.onKeyDown.bind(this)},children:[{tag:"span",attributes:{tabindex:0,class:"focus-control"},eventListeners:{focus:()=>document.querySelector(`#lightbox-${this.id} .content *`).focus()}},{tag:"div",attributes:{class:"controls"},children:[{tag:"button",attributes:{class:"left","aria-label":"Move to previous element"},eventListeners:{click:this.previous.bind(this)},children:[{tag:"i",attributes:{class:"fas fa-chevron-left"}}]},{tag:"button",attributes:{class:"right","aria-label":"Move to next element"},eventListeners:{click:this.next.bind(this)},children:[{tag:"i",attributes:{class:"fas fa-chevron-right"}}]},{tag:"button",attributes:{class:"close","aria-label":"Close the lightbox"},eventListeners:{click:this.hide.bind(this)},children:[{tag:"i",attributes:{class:"fas fa-times"}}]}]},{tag:"div",attributes:{class:"content"},children:[t,{tag:"span",text:e}]},{tag:"span",attributes:{tabindex:0,class:"focus-control"},eventListeners:{focus:()=>document.querySelector(`#lightbox-${this.id} .controls button.left`).focus()}}]})}attach(){const t=this.parent.querySelector(`.lightbox.lightbox-${this.id}`);if(this.shown){let e=this.render();t?(t.replaceWith(e),e=t):this.parent.appendChild(e),e.focus()}else t&&t.remove()}onKeyDown(t){switch(t.key){case"ArrowLeft":this.previous();break;case"ArrowRight":this.next();break;case"Escape":this.hide();break}}show(){this.shown=!0,this.lastIndex=this.index,window.scrollTo(0,0),document.body.classList.add("scroll-lock"),this.attach()}hide(){this.shown=!1,document.body.classList.remove("scroll-lock"),this.triggers[this.lastIndex].focus(),this.attach()}add(t,e){this.elements.push({element:t,label:e})}addTrigger(t,e){this.triggers[e]=t;const s=()=>{this.to(e),this.show()};t.addEventListener("click",s.bind(this)),t.addEventListener("keypress",r=>{r.key==="Enter"&&s.bind(this)()})}}class N{constructor(t,e,s){a(this,"element");a(this,"container");a(this,"registerListeners",t=>{const e=t.map(n=>Array.from(document.querySelectorAll(n))).reduce((n,l)=>[...l,...n]),s=Array.from(this.element.querySelectorAll(".modal-close-button"));Array.from(new Set([...e,...s])).forEach(n=>n.addEventListener("click",()=>this.toggleVisibility.bind(this)()))});const r=document.querySelector(t);if(!r)throw new Error(`Could not find an element in the dom with selector "${t}"`);this.element=r,this.container=s,s.addModal(this);const n=this.element.querySelector("form");n&&n.addEventListener("submit",l=>{l.preventDefault();const g=Array.from(new FormData(l.target).entries()).map(([o,c])=>({[o]:c})).reduce((o,c)=>({...o,...c}));console.log("Form submitted!",g)}),this.registerListeners(e)}toggleVisibility(){var e;this.element.classList.toggle("shown");const t=this.element.attributes.getNamedItem("aria-hidden");if(!t)throw new Error(`An "aria-hidden" attribute should be set on the modal element ${this.element}`);t.value=(t.value==="false").toString(),this.element.classList.contains("shown")&&this.element.focus(),(e=this.container)==null||e.updateContainerVisibility()}get isVisible(){return this.element.classList.contains("shown")}}class q{constructor(t){a(this,"modals",[]);a(this,"element");a(this,"htmlBody");const e=document.querySelector(t);if(!e)throw new Error(`Could not find an element in the dom with selector "${t}"`);this.element=e,this.htmlBody=this.htmlBody=document.body}updateContainerVisibility(){if(this.modals.some(t=>t.isVisible))return this.show();this.hide()}addModal(t){this.modals.push(t)}removeModal(t){this.modals=this.modals.filter(e=>e!==t)}show(){this.htmlBody.classList.add("scroll-lock"),this.element.classList.add("shown")}hide(){this.htmlBody.classList.remove("scroll-lock"),this.element.classList.remove("shown")}}class L{constructor(t,e){this.media=t,this.basePath=e}}class F extends L{thumbnail(){return d.node({tag:"article",attributes:{class:"photograph-media image","data-id":this.media.id},children:[{tag:"img",attributes:{alt:this.media.title,class:"lightbox-trigger",src:`${this.basePath}/${this.media.image}`,tabindex:0}}]})}slideshow(){return d.node({tag:"img",attributes:{alt:this.media.title,src:`${this.basePath}/${this.media.image}`,tabindex:0}})}}class O extends L{thumbnail(){return d.node({tag:"article",attributes:{class:"photograph-media video","data-id":this.media.id},children:[{tag:"video",attributes:{class:"lightbox-trigger",disablePictureInPicture:!0,alt:this.media.title,tabindex:0},children:[{tag:"source",attributes:{src:`${this.basePath}/${this.media.video}`}}]}]})}slideshow(){return d.node({tag:"video",attributes:{disablePictureInPicture:!0,alt:this.media.title,autoplay:!0,loop:!0,tabindex:0},children:[{tag:"source",attributes:{src:`${this.basePath}/${this.media.video}`}}]})}}class R{constructor(t,e){this.media=t,this.baseMediaContentPath=e}getSupportedFactory(){switch(!0){case"video"in this.media:return new O(this.media,this.baseMediaContentPath);case"image"in this.media:return new F(this.media,this.baseMediaContentPath);default:throw new Error("Invalid media provided!")}}}async function B(){const i=new q("#modals-container");new N(u.CONTACT_MODAL,[".contact-button"],i);const t=document.querySelector(u.PHOTOGRAPH_HEADER),e=document.querySelector(u.MEDIA_GRID),s=await T.getPhotographerFromUrl(new URL(window.location.href));if(!s){window.location="./index.html";return}H(s);const r=await new C().getAllMediasForPhotograph(s);d.node({tag:"div",insertionStrategy:m.APPEND,attributes:{class:"photographer-profile-picture"},children:[{tag:"img",attributes:{src:`./medias/photographers/${s.portrait}`,alt:s.name}}]},t),d.node({tag:"div",insertionStrategy:m.PREPEND,attributes:{class:" photographer-info"},children:[{tag:"h1",text:s.name},{tag:"h3",text:`${s.city}, ${s.country}`},{tag:"span",text:s.tagline}]},t);const n=new y(r.reduce((o,c)=>o+c.likes,0));w(new x().sort(r),s,n).forEach(o=>e.appendChild(o));const l=d.node({tag:"div",insertionStrategy:m.APPEND,attributes:{class:"photographer-likes"},children:[{tag:"div",children:[{tag:"span",attributes:{class:"likes-count"},text:String(n.current)},{tag:"i",attributes:{class:"fas fa-heart"}}]},{tag:"span",text:`${s.price}\u20AC/jour`}]},document.body);n.subscribeForPageLifecycle(o=>l.querySelector("span.likes-count").textContent=String(o)),new D(document.querySelector(u.MEDIA_SORTERS),{[h.TRENDING]:"Popularit\xE9",[h.DATE]:"Date",[h.TITLE]:"Titre"},h.TRENDING,"media-sorter-label").subscribeForPageLifecycle(o=>{const c=f.getSorter(o);e.textContent="";const b=new f(r).sort(c);w(b,s,n).forEach(v=>e.appendChild(v))})}function w(i,t,e){const s=new I(0,document.body);return i.map((r,n)=>{var b;const l=new R(r,`./medias/${t.id}`).getSupportedFactory(),g=(b=r.likesStore)!=null?b:new A(r,e);r.likesStore=g;const o=l.thumbnail();o.appendChild(g.render()),s.add(l.slideshow(),r.title);const c=o.querySelector(".lightbox-trigger");return s.addTrigger(c,n),o})}function H(i){document.title=`Fisheye - ${i.name}`;const e=document.querySelector(u.CONTACT_MODAL).querySelector("header h2");e.innerHTML+=`<br>${i.name}`,document.querySelector(u.CONTACT_BUTTON).removeAttribute("disabled")}B().catch(console.error);
